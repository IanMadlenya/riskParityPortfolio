---
title: "Test for Alexis Nortier"
author: 
- name: "Daniel P. Palomar"
  affiliation: "Hong Kong University of Science and Technology (HKUST)"
date: "`r Sys.Date()`"
output:
  bookdown::html_document2:
    base_format: prettydoc::html_pretty
    theme: tactile
    highlight: vignette
    fig_caption: yes
    number_sections: no
    toc: yes
    toc_depth: 2
  bookdown::pdf_document2:
    fig_caption: yes
    number_sections: yes
    toc: yes
    toc_depth: 2
header-includes:
  \allowdisplaybreaks
indent: yes
csl: ieee.csl
bibliography: refs.bib
---

```{r, echo = FALSE}
library(knitr)
opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.align = "center",
  fig.retina = 2,
  out.width = "75%",
  dpi = 96
)
knit_hooks$set(pngquant = hook_pngquant)
#Help on bookdown: https://bookdown.org/yihui/bookdown/
#rmarkdown::render("vignettes/example_Alexis_Nortier.Rmd", "bookdown::html_document2")
```

-----------
> This note contains an example under consideration by Alexis Nortier


# Risk-parity portfolio formulation
The risk-parity portfolio formulation is of the form [@FengPal2015riskparity][@FengPal2016monograph]:
$$\begin{array}{ll}
\underset{\mathbf{w}}{\textsf{minimize}} & R(\mathbf{w})\\
\textsf{subject to} & \mathbf{1}^T\mathbf{w}=1\\
 & \mathbf{w}\ge\mathbf{0},
\end{array}$$
where the risk term is of the form (double summation) $R(\mathbf{w}) = \sum_{i,j=1}^{N}(g_{ij}(\mathbf{w}))^{2}$ or simply (single summation) $R(\mathbf{w}) = \sum_{i=1}^{N}(g_{i}(\mathbf{w}))^{2}$.

# Parameter definition for the test
Consider the following parameters:
$$\boldsymbol{\Sigma} = \left[
\begin{array}{ccc}
 1.0000 &  0.0015 & -0.0119\\
 0.0015 &  1.0000 & -0.0308\\
-0.0119 & -0.0308 &  1.0000
\end{array}
\right]$$
$$\mathbf{b} = \left[
\begin{array}{c}
 0.1594 \\
 0.0126 \\
 0.8280 
\end{array}
\right]$$
and the corresponding code:
```{r}
Sigma <- rbind(c(1.0000, 0.0015, -0.0119),
               c(0.0015, 1.0000, -0.0308),
               c(-0.0119, -0.0308, 1.0000))
b <- c(0.1594, 0.0126, 0.8280 )
w0 <- b
```

The optimal solution is known to be
$$\mathbf{w}^\star = \left[
\begin{array}{c}
 0.2799 \\
 0.0877 \\
 0.6324
\end{array}
\right],$$
but the Matlab implementation seems to converge to
$$\mathbf{w} = \left[
\begin{array}{c}
 0.3106 \\
 0.0000 \\
 0.6895
\end{array}
\right],$$

# Formulation "rc double-index"
Consider the risk expression:
$$R(\mathbf{w}) = \sum_{i,j=1}^{N}\left(w_{i}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_{i}-w_{j}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_{j}\right)^{2}.$$
```{r, message=FALSE}
library(xts)
library(riskParityPortfolio)

res_gen_solver1 <- riskParityPortfolioGenSolver(Sigma, formulation = "rc-double-index")
res_sca1 <- riskParityPortfolioSCA(Sigma, formulation = "rc-double-index")
res_gen_solver1$w
res_sca1$w
```



# Formulation "rc-over-var vs b"
Consider the risk expression:
$$R(\mathbf{w}) = \sum_{i=1}^{N}\left(\frac{w_{i}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_i}{\mathbf{w}^T\boldsymbol{\Sigma}\mathbf{w}}-b_i\right)^{2}.$$
```{r, message=FALSE}
res_gen_solver2 <- riskParityPortfolioGenSolver(Sigma, b = b, formulation = "rc-over-var-vs-b")
res_gen_solver2$w
res_gen_solver2 <- riskParityPortfolioGenSolver(Sigma, b = b, w0 = w0, formulation = "rc-over-var-vs-b")
res_gen_solver2$w
res_sca2 <- riskParityPortfolioSCA(Sigma, b = b, formulation = "rc-over-var-vs-b")
res_sca2$w
res_sca2 <- riskParityPortfolioSCA(Sigma, b = b, w0 = w0, formulation = "rc-over-var-vs-b")
res_sca2$w
```

# Formulation "rc-over-sd vs b-times-sd"
Consider the risk expression:
 $$R(\mathbf{w}) = \sum_{i=1}^{N}\left(\frac{w_{i}\left(\boldsymbol{\Sigma}\mathbf{w}\right)_i}{\sqrt{\mathbf{w}^T\boldsymbol{\Sigma}\mathbf{w}}}-b_i\sqrt{\mathbf{w}^T\boldsymbol{\Sigma}\mathbf{w}}\right)^{2} = \sum_{i=1}^{N}\left(\frac{r_i}{\sqrt{\mathbf{1}^T\mathbf{r}}}-b_i\sqrt{\mathbf{1}^T\mathbf{r}}\right)^{2}.$$

```{r, eval=FALSE}
res_gen_solver3 <- riskParityPortfolioGenSolver(Sigma, b = b, formulation = "rc-over-sd-vs-b-times-sd")
res_gen_solver3$w
res_gen_solver3 <- riskParityPortfolioGenSolver(Sigma, b = b, w0 = w0, formulation = "rc-over-sd-vs-b-times-sd")
res_gen_solver3$w
res_sca3 <- riskParityPortfolioSCA(Sigma, b = b, formulation = "rc-over-sd-vs-b-times-sd")
res_sca3$w
res_sca3 <- riskParityPortfolioSCA(Sigma, b = b, w0 = w0, formulation = "rc-over-sd-vs-b-times-sd")
res_sca3$w
```


# References {-}
\setlength{\parindent}{-0.2in}
\setlength{\leftskip}{0.2in}
\setlength{\parskip}{8pt}
\noindent



